<div class="main-container">
  <!-- <div class="body-container"> -->
  <nav class="sidebar" [class.expanded]="isExpanded" *ngIf="loginUser">

    <div class="menu-items">
      <div class="menu-header">
        <ng-container *ngIf="!isExpanded; else expandedHeader">
          <button class="logo-toggle" type="button" (click)="toggleMenu()" (keydown.enter)="toggleMenu()">
            <div class="logo-box">
              <img src="assets/img/fovesta1.png" alt="Fovesta Icon" class="logo-img" (error)="onImageError($event)">
            </div>
          </button>
        </ng-container>
        <ng-template #expandedHeader>
          <div class="logo-wrapper">
            <div class="logo-box">
              <img src="assets/img/fovesta1.png" alt="Fovesta Icon" class="logo-img" (error)="onImageError($event)">
              <span class="divider-line"></span>
              <span class="label">HRMS</span>
            </div>
            <span class="hamburger-icon" (click)="toggleMenu()">
              <i class="material-icons">menu</i>
            </span>
          </div>
        </ng-template>
      </div>

      <div *ngIf="!onboardingMode">
        <div class="menu-item" *ngFor="let item of menus" [class.active]="isSubmenuOpen(item.menuID)"
          [id]="'menu-' + item.menuID">
          <div class="menu-item-content" (click)="onMenuClick($event, item)"
            [routerLink]="!hasSubmenu(item) ? item.menuPath : null" routerLinkActive="active">
            <span class="icon" matTooltip="{{ item.menuName }}" matTooltipPosition="right">
              <ng-container *ngIf="isMaterialIcon(item.menuName); else imageIcon">
                <i class="material-icons">{{ getMenuIcon(item.menuName) }}</i>
              </ng-container>
              <ng-template #imageIcon>
                <img [src]="getMenuIcon(item.menuName)" alt="{{ item.menuName }}" class="menu-img" />
              </ng-template>
            </span>
            <span class="label">{{ item.menuDisplayName }}</span>
          </div>
          <div class="submenu" *ngIf="hasSubmenu(item) && isSubmenuOpen(item.menuID) && isExpanded"
            [id]="'submenu-' + item.menuID" (click)="$event.stopPropagation()" (wheel)="onSubmenuWheel($event)">
            <a class="submenu-item" *ngFor="let subItem of item.submenu" [routerLink]="subItem.menuPath"
              routerLinkActive="active-submenu" #rla="routerLinkActive" [class.active-submenu]="rla.isActive"
              (click)="openSubmenus.clear()">
              {{ subItem.menuDisplayName }}
            </a>
          </div>
        </div>
      </div>

      <!-- Onboarding Sidebar Content -->
      <div *ngIf="onboardingMode" class="onboarding-nav">
        <ul class="nav-list">
          <li *ngFor="let item of sidebarMenuItems; let i = index" [class.active]="activeOnboardingStep === i"
            [class.completed]="isStepCompleted(i)">
            <div class="step-icon">
              <span *ngIf="!isStepCompleted(i)" class="dot"></span>
              <img *ngIf="isStepCompleted(i)" src="assets/img/check.png" class="check-icon">
            </div>
            <span class="label" *ngIf="isExpanded">{{ item }}</span>
          </li>
        </ul>
      </div>
    </div>

    <!-- <app-footer class="sidebar-footer" *ngIf="loginUser"></app-footer> -->

  </nav>
  <header class="app-header" *ngIf="loginUser">
    <div class="app-header__search" (click)="$event.stopPropagation()" *ngIf="!onboardingHeaderMode">
      <mat-icon>search</mat-icon>
      <input #globalSearchInput type="text" placeholder="Search" aria-label="Search" [(ngModel)]="globalSearchTerm"
        (input)="onHeaderInput(globalSearchInput.value)" (focus)="openGlobalSearchResults()" />
      <button type="button" class="clear-search-btn" *ngIf="globalSearchTerm" (click)="clearGlobalSearch()"
        matTooltip="Clear" matTooltipPosition="below">
        <mat-icon>close</mat-icon>
      </button>
      <div class="global-search-results" *ngIf="isGlobalSearchOpen">
        <div class="global-search-content">
          <div class="search-heading">
            <span>Employee Search</span>
            <button type="button" (click)="closeGlobalSearch()" matTooltip="Close">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <div class="search-status" *ngIf="isSearchingEmployees">
            <mat-progress-spinner diameter="28" color="primary" mode="indeterminate"></mat-progress-spinner>
            <span>Searching employeesâ€¦</span>
          </div>
          <ng-container *ngIf="!isSearchingEmployees">
            <div class="search-empty" *ngIf="!globalEmployeeResults.length">
              <mat-icon>person_off</mat-icon>
              <p>No employees found</p>
              <small>Try searching with another code or name.</small>
            </div>
            <ul class="search-result-list" *ngIf="globalEmployeeResults.length">
              <li *ngFor="let employee of globalEmployeeResults" (click)="navigateToEmployee(employee)">
                <div class="employee-initial">
                  {{ (employee?.employeeFirstName || employee?.employeeName || '?') | slice:0:1 }}
                </div>
                <div class="employee-meta">
                  <span class="employee-name">
                    {{ employee?.employeeFirstName || employee?.employeeName }}
                    {{ employee?.employeeMiddleName }}
                    {{ employee?.employeeLastName }}
                  </span>
                  <span class="employee-code" *ngIf="employee?.employeeCode">
                    Code: {{ employee?.employeeCode }}
                  </span>
                  <span class="employee-dept" *ngIf="employee?.departmentName">
                    {{ employee?.departmentName }}
                  </span>
                </div>
                <mat-icon>chevron_right</mat-icon>
              </li>
            </ul>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- Onboarding Header Left -->
    <div class="onboarding-header-left" *ngIf="onboardingHeaderMode">
      <div class="info-item">
        <mat-icon>calendar_today</mat-icon>
        <span>{{ currentTime }}</span>
      </div>
      <div class="info-item">
        <mat-icon>business</mat-icon>
        <span>Company Name: {{ companyName }}</span>
      </div>
    </div>

    <div class="app-header__brand" *ngIf="sidebarLogo">
      <img [src]="sidebarLogo" [alt]="sidebarLogoAlt" class="app-header__brand-logo" />
      <span class="app-header__brand-name">{{ companyName || 'Company Name' }}</span>
    </div>

    <div class="app-header__actions" (click)="$event.stopPropagation()" *ngIf="!onboardingHeaderMode">
      <button type="button" class="app-header__user" [class.app-header__user--empty]="!userDetails.name"
        matTooltip="{{ userDetails.name || 'User menu' }}" matTooltipPosition="left" [matMenuTriggerFor]="userMenu">
        <span class="app-header__user-initials">{{ userInitials }}</span>
      </button>
      <mat-menu #userMenu="matMenu" class="app-header__user-menu">
        <ng-template matMenuContent>
          <div class="user-menu__content">
            <div class="user-menu__card">
              <div class="user-menu__profile">
                <div class="user-menu__avatar">{{ userInitials }}</div>
                <div class="user-menu__info">
                  <div class="user-menu__name">{{ userDetails.name || 'User' }}</div>
                  <div class="user-menu__email" *ngIf="userDetails.email">{{ userDetails.email }}</div>
                </div>
              </div>
              <div class="user-menu__list"
                *ngIf="userDetails.role || userDetails.department || userDetails.designation">
                <div class="user-menu__row" *ngIf="userDetails.role">
                  <span class="user-menu__label">Role</span>
                  <span class="user-menu__value">{{ userDetails.role }}</span>
                </div>
                <div class="user-menu__row" *ngIf="userDetails.department">
                  <span class="user-menu__label">Department</span>
                  <span class="user-menu__value">{{ userDetails.department }}</span>
                </div>
                <div class="user-menu__row" *ngIf="userDetails.designation">
                  <span class="user-menu__label">Designation</span>
                  <span class="user-menu__value">{{ userDetails.designation }}</span>
                </div>
              </div>
              <div class="user-menu__footer">
                <button type="button" class="user-menu__signout" (click)="logout()">
                  <mat-icon>logout</mat-icon>
                  <span>Sign Out</span>
                </button>
              </div>
            </div>
          </div>
        </ng-template>
      </mat-menu>
    </div>

    <!-- Onboarding Header Right -->
    <div class="onboarding-header-right" *ngIf="onboardingHeaderMode">
      <span>Welcome Back, {{ userDetails.name }}!</span>
      <div class="user-avatar-initials">{{ userInitials }}</div>
    </div>
  </header>
  <div [class]="shouldApplyContentClass() ? 'content' : ''">
    <app-loader></app-loader>
    <router-outlet></router-outlet>
  </div>
  <!-- </div> -->
</div>